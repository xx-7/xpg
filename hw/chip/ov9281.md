# PLL clock

```rs

// PLL 1
let input       = 24;

let pre_div0    = 1;        // 0x030A[0]                 0    = 1
let pre_div     = 1.5;      // 0x0300[2:0]              001  = 1.5
let loop_div    = 50;       // 0x0301[1:0] 0x0302[7:0]  0x32 = 50
let m_div       = 0;        // 0x0303[3:0]              0    = 0
let mipi_div    = 8;        // 0x0304[1:0]              11   = 8
let sys_pre_dev = 5;        // 0x0305[2:0]              10   = 5
let sys_div     = 2;        // 0x0306[0]                1    = 2

// 800Mhz = 24MHz / 1 / 1.5 * 50 / (1 + 0)
let pre_clk = input / pre_div0 / pre_div * loop_div / (1 + m_div);

// 100Mhz = 800Mhz / 8
let mipi_clk = pre_clk / mipi_div;

// 160Mhz = 800Mhz / 5
let sys_clk1 = pre_clk / sys_pre_dev;

// 80Mhz = 160Mhz / 2
let sys_clk = sys_clk1 / sys_div;

// PLL 2
let input       = 24;

let pre_div0    = 1;        // 0x0314[0]                0    = 1
let pre_div     = 3;        // 0x030B[2:0]              100  = 3
let loop_div    = 80;       // 0x030C[1:0] 0x030D[7:0]  0x50 = 80
let sys_div     = 2;        // 0x030E[2:0]              010  = 2
let sys_pre_dev = 3;        // 0x030F[3:0]              3
let dac_div     = 1;        // 0x0313[3:0]              1
let sa1_div     = 7;        // 0x0312[3:0]              7

// 640Mhz = 24MHz / 1 / 3 * 80
let pre_clk = input / pre_div0 / pre_div * loop_div;

// 320Mhz = 640Mhz / (1 + 1)
let dac_clk = pre_clk / (1 + dac_div);;

// 80Mhz = 640Mhz / (1 + 7)
let analog_clk = pre_clk / (1 + sa1_div);

// 80Mhz = 640Mhz / (1 + 3) / 2
let sys_clk = pre_clk / (1 + sys_pre_dev) / sys_div;

// 两个 sys clock最好频率一样否则容易出问题， 有时不出图

```

# FPS EXPO

```rs

// hts 列周期
// vts 行周期

let hts     = 728;        // 0x380C 0x380D  0x02D8 = 728
let vts     = 910;        // 0x380E 0x380F  0x038E = 910
let sys_clk = 80000000;   // sys_clk = PLL2_sys_clk = 80Mhz

// fps = sys_clk / hts / vts
let fps     = 120.75;     // 80000000 / 728 / 910

// expo 曝光 单位是行周期, 最小值是1, 是大值是 行周期 - 25
// reg addr 0x3500
let expo = 0x200

```
